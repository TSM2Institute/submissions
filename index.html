<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSM2 Institute for Cosmology – Submission Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'dark-blue': '#0a1628',
                        'accent-blue': '#1e3a5f',
                        'light-blue': '#3b82f6',
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .hero-bg {
            background: linear-gradient(135deg, #0a1628 0%, #1e3a5f 50%, #0f172a 100%);
            position: relative;
            overflow: hidden;
        }
        .hero-bg::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.3), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.2), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.4), transparent),
                radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.2), transparent),
                radial-gradient(1px 1px at 160px 120px, rgba(255,255,255,0.3), transparent),
                radial-gradient(2px 2px at 200px 50px, rgba(255,255,255,0.25), transparent),
                radial-gradient(1px 1px at 250px 90px, rgba(255,255,255,0.35), transparent),
                radial-gradient(2px 2px at 300px 150px, rgba(255,255,255,0.2), transparent);
            background-size: 450px 200px;
            opacity: 0.8;
            pointer-events: none;
        }
        .nebula-glow {
            position: absolute;
            width: 600px; height: 600px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, rgba(30,58,95,0.05) 50%, transparent 70%);
            top: -200px; right: -100px;
            pointer-events: none;
        }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="font-inter bg-gray-50 text-gray-900 min-h-screen flex flex-col">
    <header class="hero-bg text-white py-12 md:py-16 relative">
        <div class="nebula-glow"></div>
        <div class="max-w-4xl mx-auto px-6 text-center relative z-10">
            <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold mb-3 tracking-tight">TSM2 Institute for Cosmology</h1>
            <h2 class="text-lg md:text-xl font-light text-blue-200 mb-4">Submission Portal</h2>
            <p class="text-base md:text-lg font-medium text-blue-100 mb-2">Binary Compliance Gate – Structured Claims Only</p>
            <p class="text-sm text-blue-200/80 max-w-2xl mx-auto leading-relaxed">All submissions are evaluated on a binary basis. A full PDF document is mandatory and becomes the authoritative record.</p>
        </div>
    </header>

    <main class="flex-grow py-8 md:py-12 px-4 md:px-6" x-data="submissionForm()" x-cloak>
        <div class="max-w-4xl mx-auto">
            <div class="bg-white border border-gray-200 rounded-xl shadow-sm mb-6 overflow-hidden" x-data="{ open: false }">
                <button @click="open = !open" class="w-full px-6 py-4 flex items-center justify-between text-left hover:bg-gray-50 transition-colors">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-dark-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <span class="font-semibold text-dark-blue">Submission Instructions & Governance</span>
                    </div>
                    <svg class="w-5 h-5 text-gray-500 transition-transform" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                    </svg>
                </button>
                <div x-show="open" x-collapse class="border-t border-gray-100">
                    <div class="px-6 py-4">
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                            <h4 class="font-semibold text-dark-blue mb-2">Compliance Determination (Binary)</h4>
                            <p class="text-sm text-gray-700 mb-2">All submissions are evaluated on a binary basis:</p>
                            <ul class="text-sm text-gray-700 space-y-1 ml-4">
                                <li><span class="text-green-600 font-bold">✓</span> <strong>Compliant</strong> — all mandatory criteria satisfied</li>
                                <li><span class="text-red-600 font-bold">✗</span> <strong>Non-Compliant</strong> — one or more mandatory criteria not satisfied</li>
                            </ul>
                            <p class="text-sm text-gray-600 mt-2">There is no conditional or partial compliance. Non-compliant submissions may be revised and resubmitted without prejudice.</p>
                        </div>
                        <div class="grid sm:grid-cols-2 gap-3">
                            <a href="/public/files/governance.md" target="_blank" class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-light-blue transition-colors group">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                                    <svg class="w-5 h-5 text-dark-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900 text-sm">Governance Protocol v1.0</p>
                                    <p class="text-xs text-gray-500">governance.md</p>
                                </div>
                            </a>
                            <a href="/public/files/compliance.docx" download class="flex items-center gap-3 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 hover:border-light-blue transition-colors group">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center group-hover:bg-blue-200 transition-colors">
                                    <svg class="w-5 h-5 text-dark-blue" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="font-medium text-gray-900 text-sm">Compliance Charter</p>
                                    <p class="text-xs text-gray-500">compliance.docx</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <template x-if="submitted">
                <div class="bg-white border border-green-200 rounded-xl shadow-lg p-8 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Submission Received</h3>
                    <p class="text-gray-600 mb-2">Your compliance case has been created successfully.</p>
                    <p class="text-sm text-gray-500 mb-4">Your personal details have been sent privately to the Institute Director (not public).</p>
                    <a :href="issueUrl" target="_blank" class="inline-flex items-center gap-2 px-6 py-3 bg-dark-blue text-white font-medium rounded-lg hover:bg-accent-blue transition-colors">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
                        View Issue on GitHub
                    </a>
                </div>
            </template>

            <template x-if="!submitted">
                <div class="bg-white border border-gray-200 rounded-xl shadow-lg overflow-hidden">
                    <div class="bg-gray-50 border-b border-gray-200 px-6 py-4">
                        <h3 class="text-lg font-semibold text-dark-blue">TSM2 Submission Form</h3>
                        <p class="text-sm text-gray-600 mt-1">Complete all required fields. A mandatory PDF attachment becomes the authoritative record for compliance review.</p>
                    </div>

                    <div class="px-6 py-4 border-b border-gray-100">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Progress</span>
                            <span class="text-sm text-gray-500" x-text="`Step ${currentStep} of ${totalSteps}`"></span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-light-blue h-2 rounded-full transition-all duration-300" :style="`width: ${(currentStep / totalSteps) * 100}%`"></div>
                        </div>
                        <div class="flex justify-between mt-3 text-xs text-gray-500 overflow-x-auto">
                            <template x-for="(label, index) in stepLabels" :key="index">
                                <span :class="{'text-light-blue font-medium': currentStep === index + 1, 'text-green-600': currentStep > index + 1}" class="whitespace-nowrap px-1" x-text="label"></span>
                            </template>
                        </div>
                    </div>

                    <form @submit.prevent="submitForm" class="px-6 py-6">
                        <div x-show="currentStep === 1" x-transition>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">Step 1: Your Information</h4>
                            <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-amber-800"><strong>Privacy Notice:</strong> Your personal details will be sent privately to the Institute Director and will NOT appear in the public GitHub issue.</p>
                            </div>
                            <div class="space-y-4">
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name <span class="text-red-500">*</span></label>
                                        <input type="text" x-model="userInfo.name" placeholder="Your full name" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Address <span class="text-red-500">*</span></label>
                                        <input type="email" x-model="userInfo.email" placeholder="your@email.com" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue" required>
                                    </div>
                                </div>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Organization <span class="text-gray-400 font-normal">(optional)</span></label>
                                        <input type="text" x-model="userInfo.organization" placeholder="University, Institute, etc." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Contact Number <span class="text-gray-400 font-normal">(optional)</span></label>
                                        <input type="tel" x-model="userInfo.phone" placeholder="+1 234 567 8900" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Website <span class="text-gray-400 font-normal">(optional)</span></label>
                                    <input type="url" x-model="userInfo.website" placeholder="https://yourwebsite.com" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue">
                                </div>
                            </div>
                        </div>

                        <div x-show="currentStep === 2" x-transition>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">Step 2: Submission Details</h4>
                            <div class="space-y-5">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Submission Title <span class="text-red-500">*</span></label>
                                    <input type="text" x-model="form.submission_title" placeholder="Clear, specific title – no rhetoric" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue" required>
                                    <p class="text-xs text-gray-500 mt-1">A clear, descriptive title for your submission.</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">One-Sentence Core Claim <span class="text-red-500">*</span> <span class="text-gray-400 font-normal">(<span x-text="form.core_claim.length"></span>/300)</span></label>
                                    <textarea x-model="form.core_claim" maxlength="300" rows="3" placeholder="e.g., 'X causes Y via Z under conditions C.' Single explicit claim only. No background." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue" required></textarea>
                                    <p class="text-xs text-gray-500 mt-1">State exactly what you are claiming — no background, no rhetoric.</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Primary Scale <span class="text-red-500">*</span></label>
                                    <select x-model="form.primary_scale" class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue" required>
                                        <option value="">Select scale...</option>
                                        <option>Laboratory</option>
                                        <option>Planetary</option>
                                        <option>Stellar</option>
                                        <option>Galactic</option>
                                        <option>Cosmic</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div x-show="currentStep === 3" x-transition>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">Step 3: Falsifiability Condition</h4>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-blue-800"><strong>Required:</strong> At least one explicit condition under which the claim would be false. Must be testable in principle (now or in future). Claims immune to falsification are not accepted.</p>
                            </div>
                            <div class="space-y-5">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Falsifiability Condition <span class="text-red-500">*</span></label>
                                    <textarea x-model="form.falsifiability" rows="5" placeholder="What specific result, observation, or experiment would prove this claim false? Be precise and testable." class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-light-blue focus:border-light-blue" required></textarea>
                                    <p class="text-xs text-gray-500 mt-1">Describe what would definitively falsify your claim.</p>
                                </div>
                            </div>
                        </div>

                        <div x-show="currentStep === 4" x-transition>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">Step 4: Full Document Upload</h4>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4">
                                <p class="text-sm text-blue-800"><strong>Mandatory:</strong> Attach the complete PDF containing your full argument/framework. This is the definitive record for compliance review.</p>
                            </div>
                            <div class="space-y-5">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">PDF Document <span class="text-red-500">*</span></label>
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-light-blue transition-colors"
                                         :class="{'border-green-400 bg-green-50': pdfFile}">
                                        <template x-if="!pdfFile">
                                            <div>
                                                <svg class="w-12 h-12 text-gray-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                                </svg>
                                                <p class="text-gray-600 mb-2">Drag and drop your PDF here, or click to browse</p>
                                                <p class="text-xs text-gray-500">Maximum file size: 100MB</p>
                                            </div>
                                        </template>
                                        <template x-if="pdfFile">
                                            <div>
                                                <svg class="w-12 h-12 text-green-500 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                                </svg>
                                                <p class="text-green-700 font-medium" x-text="pdfFile.name"></p>
                                                <p class="text-xs text-green-600" x-text="formatFileSize(pdfFile.size)"></p>
                                                <button type="button" @click="pdfFile = null; $refs.pdfInput.value = ''" class="mt-2 text-sm text-red-600 hover:text-red-800">Remove file</button>
                                            </div>
                                        </template>
                                        <input type="file" 
                                               x-ref="pdfInput"
                                               accept=".pdf"
                                               @change="handleFileSelect($event)"
                                               class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                                               style="position: absolute; top: 0; left: 0;">
                                    </div>
                                    <p class="text-xs text-gray-500 mt-2">The attached PDF constitutes the authoritative submission record for compliance, audit, and registry purposes.</p>
                                </div>
                            </div>
                        </div>

                        <div x-show="currentStep === 5" x-transition>
                            <h4 class="text-lg font-semibold text-gray-900 mb-4 pb-2 border-b">Step 5: Declaration</h4>
                            <div class="space-y-5">
                                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                    <label class="flex items-start gap-3 cursor-pointer">
                                        <input type="checkbox" x-model="form.declaration" class="mt-1 rounded text-light-blue focus:ring-light-blue" required>
                                        <span class="text-sm text-gray-700">
                                            I have read and accept the <a href="/public/files/governance.md" target="_blank" class="text-light-blue underline">Submission Instructions</a>. I understand that:
                                            <ul class="mt-2 ml-4 list-disc space-y-1 text-gray-600">
                                                <li>Compliance is binary (Compliant / Non-Compliant)</li>
                                                <li>Compliance does not imply endorsement of the claim</li>
                                                <li>The attached PDF is the authoritative version for review</li>
                                                <li>Non-compliant submissions may be revised and resubmitted</li>
                                            </ul>
                                        </span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div x-show="error" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                            <p class="text-sm text-red-700" x-text="error"></p>
                        </div>

                        <div x-show="complianceResult" class="mt-4 p-4 rounded-lg" :class="complianceResult?.compliant ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'">
                            <div class="flex items-start gap-3">
                                <template x-if="complianceResult?.compliant">
                                    <svg class="w-6 h-6 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                </template>
                                <template x-if="!complianceResult?.compliant">
                                    <svg class="w-6 h-6 text-amber-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                    </svg>
                                </template>
                                <div>
                                    <p class="font-medium" :class="complianceResult?.compliant ? 'text-green-800' : 'text-amber-800'" x-text="complianceResult?.compliant ? 'Initial Compliance Check: PASSED' : 'Initial Compliance Check: Review Needed'"></p>
                                    <p class="text-sm mt-1" :class="complianceResult?.compliant ? 'text-green-700' : 'text-amber-700'" x-text="complianceResult?.message"></p>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-between mt-8 pt-4 border-t border-gray-100">
                            <button type="button" @click="prevStep" x-show="currentStep > 1" class="px-5 py-2.5 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                Back
                            </button>
                            <div x-show="currentStep === 1"></div>
                            
                            <button type="button" @click="nextStep" x-show="currentStep < totalSteps" class="px-5 py-2.5 bg-light-blue text-white font-medium rounded-lg hover:bg-blue-600 transition-colors ml-auto">
                                Continue
                            </button>
                            
                            <button type="submit" x-show="currentStep === totalSteps" :disabled="isSubmitting || !form.declaration" class="px-6 py-2.5 bg-dark-blue text-white font-medium rounded-lg hover:bg-accent-blue transition-colors disabled:opacity-50 disabled:cursor-not-allowed ml-auto flex items-center gap-2">
                                <template x-if="isSubmitting">
                                    <svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                    </svg>
                                </template>
                                <span x-text="isSubmitting ? 'Submitting...' : 'Submit for Compliance Review'"></span>
                            </button>
                        </div>
                    </form>
                </div>
            </template>
        </div>
    </main>

    <footer class="bg-dark-blue text-white py-6">
        <div class="max-w-4xl mx-auto px-6 text-center">
            <p class="text-sm text-blue-200">TSM2 Institute for Cosmology</p>
            <p class="text-xs text-blue-300/70 mt-1">The Institute does not decide what is true. It determines whether a claim is structured well enough to be tested.</p>
        </div>
    </footer>

    <script>
        function submissionForm() {
            return {
                currentStep: 1,
                totalSteps: 5,
                stepLabels: ['Your Info', 'Details', 'Falsifiability', 'Document', 'Declaration'],
                isSubmitting: false,
                submitted: false,
                issueUrl: '',
                error: '',
                pdfFile: null,
                complianceResult: null,
                
                userInfo: {
                    name: '',
                    email: '',
                    organization: '',
                    phone: '',
                    website: ''
                },
                
                form: {
                    submission_title: '',
                    core_claim: '',
                    primary_scale: '',
                    falsifiability: '',
                    declaration: false
                },

                formatFileSize(bytes) {
                    if (bytes === 0) return '0 Bytes';
                    const k = 1024;
                    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                    const i = Math.floor(Math.log(bytes) / Math.log(k));
                    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                },

                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        if (file.type !== 'application/pdf') {
                            this.error = 'Please select a PDF file.';
                            return;
                        }
                        if (file.size > 100 * 1024 * 1024) {
                            this.error = 'File size must be less than 100MB.';
                            return;
                        }
                        this.pdfFile = file;
                        this.error = '';
                    }
                },

                validateStep() {
                    this.error = '';
                    
                    switch(this.currentStep) {
                        case 1:
                            if (!this.userInfo.name.trim()) {
                                this.error = 'Full name is required.';
                                return false;
                            }
                            if (!this.userInfo.email.trim() || !this.userInfo.email.includes('@')) {
                                this.error = 'Valid email address is required.';
                                return false;
                            }
                            return true;
                        case 2:
                            if (!this.form.submission_title.trim()) {
                                this.error = 'Submission title is required.';
                                return false;
                            }
                            if (!this.form.core_claim.trim()) {
                                this.error = 'Core claim is required.';
                                return false;
                            }
                            if (!this.form.primary_scale) {
                                this.error = 'Primary scale is required.';
                                return false;
                            }
                            return true;
                        case 3:
                            if (!this.form.falsifiability.trim()) {
                                this.error = 'Falsifiability condition is required.';
                                return false;
                            }
                            return true;
                        case 4:
                            if (!this.pdfFile) {
                                this.error = 'PDF document is required.';
                                return false;
                            }
                            return true;
                        case 5:
                            if (!this.form.declaration) {
                                this.error = 'You must accept the declaration to submit.';
                                return false;
                            }
                            return true;
                    }
                    return true;
                },

                nextStep() {
                    if (this.validateStep()) {
                        this.currentStep++;
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                prevStep() {
                    if (this.currentStep > 1) {
                        this.currentStep--;
                        this.error = '';
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                },

                generateMarkdown() {
                    return `## TSM2 Institute Submission

### Submission Details
- **Title:** ${this.form.submission_title}
- **Primary Scale:** ${this.form.primary_scale}

**Core Claim:**
${this.form.core_claim}

---

### Falsifiability Condition
${this.form.falsifiability}

---

### Document
- **PDF Attached:** ${this.pdfFile ? this.pdfFile.name : 'None'}
- **File Size:** ${this.pdfFile ? this.formatFileSize(this.pdfFile.size) : 'N/A'}

---

### Declaration
- [x] Submitter has read and accepted the Submission Instructions
- [x] Understands compliance is binary and does not imply endorsement
- [x] Confirms the attached PDF is the authoritative version`;
                },

                async submitForm() {
                    if (!this.validateStep()) return;

                    this.isSubmitting = true;
                    this.error = '';
                    this.complianceResult = null;

                    try {
                        const formData = new FormData();
                        formData.append('title', `[TSM2-SUB] ${this.form.submission_title}`);
                        formData.append('body', this.generateMarkdown());
                        formData.append('pdf', this.pdfFile);
                        formData.append('userInfo', JSON.stringify(this.userInfo));
                        formData.append('formData', JSON.stringify(this.form));

                        const response = await fetch('/api/submit', {
                            method: 'POST',
                            body: formData
                        });

                        const data = await response.json();

                        if (!response.ok) {
                            throw new Error(data.error || 'Submission failed');
                        }

                        if (data.complianceCheck) {
                            this.complianceResult = data.complianceCheck;
                        }

                        this.issueUrl = data.html_url;
                        this.submitted = true;
                    } catch (err) {
                        this.error = err.message || 'Failed to submit. Please try again.';
                    } finally {
                        this.isSubmitting = false;
                    }
                }
            };
        }
    </script>
</body>
</html>
